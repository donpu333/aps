<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tools - Alerts & Calculators</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2196F3;
            --secondary: #1976D2;
            --accent-red: #C62828;
            --accent-green: #2E7D32;
            --accent-orange: #FF6D00;
            --dark: #121212;
            --light: #ffffff;
            --success-color: #03DAC6;
            --warning-color: #FFA000;
            --teal-accent: #4CAF50;
            --green-gradient-start: #4CAF50;
            --green-gradient-end: #2E7D32;
            --red-gradient-start: #F44336;
            --red-gradient-end: #C62828;
            --border-radius: 12px;
        }
        
        /* ... (остальные стили остаются без изменений) ... */
    </style>
</head>
<body class="bg-dark">
    <!-- Навигационная панель -->
    <nav class="shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <i class="fas fa-bell text-primary text-xl mr-2"></i>
                    <span class="text-xl font-bold text-light">Crypto Tools</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="menu-container">
                        <button class="menu-button" id="menuButton">
                            <i class="fas fa-bars mr-2"></i>Меню
                        </button>
                        <div class="menu-content" id="menuContent">
                            <a href="#" class="menu-item" onclick="showCalculator()">
                                <i class="fas fa-calculator mr-2"></i>Калькулятор
                            </a>
                            <div class="menu-divider"></div>
                            <a href="#" class="menu-item" onclick="showLoginForm()" id="loginMenuItem">
                                <i class="fas fa-sign-in-alt mr-2"></i>Вход
                            </a>
                            <a href="#" class="menu-item" onclick="showRegisterForm()" id="registerMenuItem">
                                <i class="fas fa-user-plus mr-2"></i>Регистрация
                            </a>
                            <a href="#" class="menu-item hidden" onclick="handleLogout()" id="logoutMenuItem">
                                <i class="fas fa-sign-out-alt mr-2"></i>Выход
                            </a>
                        </div>
                    </div>
                    <div id="connectionStatus" class="connection-status">
                        <div class="status-dot status-connecting"></div>
                        <span>Подключение к Binance...</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Основное содержимое -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Колонка с алертами -->
            <div class="space-y-6">
                <!-- Форма создания алерта -->
                <div class="card rounded-lg p-6">
                    <h2 class="text-xl font-bold mb-6 text-primary">
                        <i class="fas fa-plus-circle mr-2"></i>Создать новый алерт
                    </h2>
                    
                    <form id="alertForm">
                        <input type="hidden" id="editAlertId" value="">
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Криптовалюта</label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="coinSearch" 
                                    placeholder="Поиск монеты..." 
                                    class="w-full pl-10 pr-4 py-2 rounded-md focus:ring-primary focus:border-primary"
                                    required
                                >
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                                <div id="marketTypeHint" class="market-type-hint"></div>
                            </div>
                            <div id="coinError" class="validation-message">Пожалуйста, выберите криптовалюту</div>
                            <select id="symbol" size="5" class="w-full mt-2 px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary hidden">
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Тип алерта</label>
                            <select id="alertType" class="w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="price">Цена</option>
                                <option value="liquidation">Ликвидации</option>
                                <option value="funding">Фандинг</option>
                                <option value="oi">Открытый интерес</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Условие</label>
                            <div class="flex">
                                <select id="condition" class="w-1/3 px-3 py-2 rounded-l-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                    <option value=">">Выше</option>
                                    <option value="<">Ниже</option>
                                </select>
                                <input 
                                    type="number" 
                                    id="value" 
                                    class="w-2/3 px-3 py-2 border-t border-b border-r rounded-r-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" 
                                    placeholder="Значение"
                                    step="0.0001"
                                    required
                                >
                            </div>
                            <div id="valueError" class="validation-message">Пожалуйста, укажите значение</div>
                            <div id="currentPriceContainer" class="current-price-container hidden">
                                <span class="current-price-label">Текущая цена:</span>
                                <span id="currentPriceValue" class="current-price-value"></span>
                                <button type="button" onclick="applyCurrentPrice()" class="apply-price-btn" title="Применить текущую цену">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Применить</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Количество уведомлений</label>
                            <select id="notificationCount" class="w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="1">1 раз (интервал 30 сек)</option>
                                <option value="2">2 раза (интервал 30 сек)</option>
                                <option value="3">3 раза (интервал 30 сек)</option>
                                <option value="4">4 раза (интервал 30 сек)</option>
                                <option value="5">5 раз (интервал 30 сек)</option>
                                <option value="0">Пока не отключу (интервал 30 сек)</option>
                            </select>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Уведомления</label>
                            <div class="notification-methods">
                                <div class="notification-method">
                                    <input id="telegram" type="checkbox" checked class="h-4 w-4 focus:ring-primary">
                                    <label for="telegram" class="ml-2 block text-sm text-gray-300">
                                        <i class="fab fa-telegram mr-1 text-blue-400"></i> Telegram
                                    </label>
                                    <button onclick="openTelegramSettings()" class="ml-2 text-sm text-blue-400 hover:text-blue-300 text-xs px-2 py-1">
                                        Настроить
                                    </button>
                                    <input 
                                        type="text" 
                                        id="userChatId" 
                                        placeholder="Ваш Chat ID" 
                                        class="ml-2 px-2 py-1 text-sm rounded-md hidden"
                                    >
                                </div>
                                <div class="notification-method">
                                    <input id="email" type="checkbox" class="h-4 w-4 focus:ring-primary">
                                    <label for="email" class="ml-2 block text-sm text-gray-300">
                                        <i class="fas fa-envelope mr-1 text-gray-400"></i> Email
                                    </label>
                                    <input 
                                        type="email" 
                                        id="userEmail" 
                                        placeholder="Ваш email" 
                                        class="ml-2 px-2 py-1 text-sm rounded-md hidden"
                                    >
                                    <div id="userEmailError" class="validation-message">Неверный формат email</div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full text-white py-2 px-4 rounded-md font-medium mt-4">
                            <i class="fas fa-bell mr-2"></i><span id="submitBtnText">Создать алерт</span>
                        </button>
                    </form>
                </div>
                
                <!-- Список алертов -->
                <div class="card rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-primary">
                            <i class="fas fa-bell mr-2"></i>Ваши алерты
                        </h2>
                        <div class="flex space-x-2">
                            <button id="showActiveAlerts" class="px-3 py-1 bg-blue-900 text-blue-300 rounded-md text-sm">
                                Активные
                            </button>
                            <button id="showTriggeredAlerts" class="px-3 py-1 bg-gray-700 text-gray-300 rounded-md text-sm">
                                Сработавшие
                            </button>
                            <button id="showAllAlerts" class="px-3 py-1 bg-gray-700 text-gray-300 rounded-md text-sm">
                                Все
                            </button>
                        </div>
                    </div>
                    
                    <div id="userAlerts" class="space-y-4 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-400 py-4">
                            У вас пока нет активных алертов
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Колонка с калькуляторами -->
            <div class="space-y-6">
                <!-- Калькулятор рисков -->
                <div class="card rounded-lg p-6">
                    <h2 class="text-xl font-bold mb-4 text-primary">Калькулятор рисков</h2>
                    
                    <div class="mb-4">
                        <div class="flex space-x-2 mb-4">
                            <button id="longBtn" class="flex-1 py-2 bg-green-600 text-white rounded-md font-medium">
                                Лонг
                            </button>
                            <button id="shortBtn" class="flex-1 py-2 bg-red-600 text-white rounded-md font-medium">
                                Шорт
                            </button>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Цена входа (USDT)</label>
                            <input type="number" id="entryPrice" class="w-full px-3 py-2 rounded-md" value="100.00" min="0" step="0.01">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Кредитное плечо</label>
                            <div class="flex items-center space-x-4">
                                <input type="range" id="leverage" class="flex-1" min="1" max="100" value="1">
                                <span id="leverageValue" class="text-primary font-medium">1x</span>
                            </div>
                            <div id="leverageWarning" class="text-red-400 text-xs mt-1 hidden">
                                Высокое плечо увеличивает риск ликвидации!
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">ATR (USDT)</label>
                            <input type="number" id="atr" class="w-full px-3 py-2 rounded-md" value="5.00" min="0" step="0.01">
                            <div class="text-yellow-400 text-xs mt-1">
                                Размер ATR: <span id="atrValue">5.00</span> USDT
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Риск стоп-лосс (% от ATR)</label>
                            <div class="flex items-center space-x-4">
                                <input type="range" id="riskPercent" class="flex-1" min="1" max="100" value="50">
                                <span id="riskPercentValue" class="text-primary font-medium">50%</span>
                            </div>
                            <div class="text-yellow-400 text-xs mt-1">
                                Стоп-лосс: <span id="previewAtrPercent">2.50</span> USDT (<span id="previewAtrPercentValue">50%</span> от ATR)
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Риск на сделку (USDT)</label>
                            <input type="number" id="riskAmount" class="w-full px-3 py-2 rounded-md" value="100.00" min="0" step="0.01">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-medium mb-2">Соотношение тейк-профита (1:X)</label>
                            <div class="flex items-center space-x-4">
                                <input type="range" id="rewardRatio" class="flex-1" min="1" max="10" value="3">
                                <span id="rewardRatioValue" class="text-primary font-medium">3</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 pt-4">
                        <div class="flex justify-between py-2">
                            <span>Размер позиции:</span>
                            <span id="positionSize" class="font-medium">0.0000</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Стоп-лосс:</span>
                            <span id="stopLoss" class="text-red-400 font-medium">0.00 USDT</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Тейк-профит (1:<span id="currentRatio">3</span>):</span>
                            <span id="takeProfit" class="text-green-400 font-medium">0.00 USDT</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Потенциальная прибыль:</span>
                            <span id="potentialProfit" class="text-green-400 font-medium">0.00 USDT</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span>Цена ликвидации:</span>
                            <span id="liquidationPrice" class="text-red-400 font-medium">0.00 USDT</span>
                        </div>
                    </div>
                    
                    <button id="exportTextBtn" class="w-full mt-4 py-2 bg-primary text-white rounded-md font-medium">
                        Экспорт в текст
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div id="notificationModal" class="fixed bottom-4 right-4 w-80 bg-gray-800 rounded-lg shadow-lg border-l-4 border-green-500 hidden">
        <div class="p-4">
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <h3 class="font-medium text-white" id="notificationTitle">Алерт сработал</h3>
                    <p class="text-sm text-gray-300 mt-1" id="notificationMessage"></p>
                </div>
                <button id="closeNotification" class="ml-2 text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Telegram Settings Modal -->
    <div id="telegramSettingsModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-primary">Настройка Telegram</h3>
                <button onclick="closeTelegramSettings()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <p class="text-gray-300 mb-4">Для получения уведомлений:</p>
                
                <ol class="list-decimal text-gray-300 pl-6 mb-4">
                    <li class="mb-2">Найдите бота: @CryptoAlert88_bot</li>
                    <li class="mb-2">Нажмите Start в диалоге с ботом</li>
                    <li class="mb-2">Введите ваш Chat ID ниже</li>
                </ol>
                
                <div class="mb-4">
                    <label class="block text-gray-300 text-sm font-medium mb-2">Ваш Chat ID</label>
                    <input 
                        type="text" 
                        id="telegramChatId" 
                        placeholder="Ваш Chat ID" 
                        class="w-full px-3 py-2 rounded-md bg-gray-700 text-white"
                    >
                </div>
                
                <button onclick="saveTelegramSettings()" class="w-full py-2 bg-primary text-white rounded-md font-medium">
                    Сохранить
                </button>
            </div>
        </div>
    </div>

    <script>
        // Полный JavaScript код с предыдущего ответа
        // ... (вставьте сюда весь JavaScript код из предыдущего ответа) ...
    </script>
</body>
</html>
